import streamlit as st
import google.generativeai as genai
import os

# --- 1. é é¢è¨­å®š ---
st.set_page_config(page_title="å¤ªé­¯é–£èªèªæ³•æ¨™è¨»åŠ©æ‰‹", page_icon="ğŸ”ï¸", layout="wide")

st.title("ğŸ”ï¸ å¤ªé­¯é–£èªè‡ªå‹•èªæ³•æ¨™è¨»ç³»çµ±")
st.markdown("ä¾æ“š**ã€Šå¤ªé­¯é–£èªèªæ³•æ¦‚è«–ã€‹** (2018) ä¹‹ã€Œå››è¡Œå¼ã€æ¨™è¨»é«”ç³»é€²è¡Œåˆ†æã€‚")

# --- 2. å´é‚Šæ¬„è¨­å®š (å›ºå®šæ¨¡å‹ç‰ˆæœ¬) ---
with st.sidebar:
    st.header("âš™ï¸ è¨­å®š")
    
    # å„ªå…ˆå˜—è©¦å¾ Secrets è®€å– Key
    if "GOOGLE_API_KEY" in st.secrets:
        api_key = st.secrets["GOOGLE_API_KEY"]
        st.success("ğŸ”‘ å·²è®€å–ç³»çµ±å…§å»º API Key")
    else:
        api_key = st.text_input("è¼¸å…¥ Google AI API Key", type="password")
        st.markdown("[å¦‚ä½•å–å¾— Google API Key?](https://aistudio.google.com/app/apikey)")
    
    st.info("ğŸ¤– æ¨¡å‹ç‰ˆæœ¬ï¼šFixed (gemini-2.0-flash-001)")
    st.caption("è¦å‰‡ä¾æ“šï¼šã€Šå¤ªé­¯é–£èªèªæ³•æ¦‚è«–ã€‹ç¬¬27é -æœ¬æ›¸ä½¿ç”¨èªªæ˜")

# --- 3. å®šç¾©èªæ³•è¦å‰‡ System Prompt (åš´æ ¼ä¾ç…§æ›¸ä¸­å®šç¾©) ---
grammar_rules = """
ä½ æ˜¯ä¸€ä½å°ˆç²¾æ–¼ã€Šå¤ªé­¯é–£èªèªæ³•æ¦‚è«–ã€‹(2018, æä½©å®¹/è¨±éŸ‹æ™Ÿ) çš„èªè¨€å­¸å®¶ã€‚
è«‹é‡å°ä½¿ç”¨è€…çš„è¼¸å…¥å¥å­ï¼Œè£½ä½œç¬¦åˆæ›¸ä¸­ã€Œä½¿ç”¨èªªæ˜ã€çš„å››è¡Œå¼å°é½Šåˆ†æã€‚

ã€åˆ†ææ ¼å¼åŸå‰‡ã€‘
è«‹è¼¸å‡ºä¸€å€‹ Markdown è¡¨æ ¼ï¼Œ**è¡¨æ ¼çš„æ¯ä¸€ã€Œæ¬„ã€(Column) ä»£è¡¨å¥å­ä¸­çš„ä¸€å€‹å–®è©**ã€‚
è¡¨æ ¼å¿…é ˆåŒ…å«ä»¥ä¸‹ä¸‰åˆ— (Row)ï¼Œç¬¬å››è¡Œç¿»è­¯å‰‡ç½®æ–¼è¡¨æ ¼ä¸‹æ–¹ï¼š

1. **ç¬¬ä¸€åˆ— (è¡¨å±¤å½¢å¼)**ï¼šåŸå§‹å¥å­çš„æ›¸å¯«å½¢å¼ã€‚
2. **ç¬¬äºŒåˆ— (åŸºåº•å½¢å¼)**ï¼šé‚„åŸè©æ ¹èˆ‡è©ç¶´ï¼Œä¸¦ä½œæ§‹è©åˆ†æã€‚
   - ä½¿ç”¨ `-` é€£æ¥è©ç¶´ (å¦‚ `pe-`, `-an`)ã€‚
   - ä½¿ç”¨ `=` é€£æ¥ä¾é™„è© (å¦‚ `=su`, `=mu`)ã€‚
   - ä½¿ç”¨ `< >` åŒ…è¦†ä¸­ç¶´ (å¦‚ `r<m>engag`, `m<n>ekan`)ã€‚
   - è¤‡åˆè©ä½¿ç”¨ `~` æˆ–ç©ºæ ¼ã€‚
3. **ç¬¬ä¸‰åˆ— (èªæ³•å°æ‡‰)**ï¼šå€‹åˆ¥è©å½™çš„ä¸­æ–‡èªæ„åŠåŠŸèƒ½æ¨™è¨»ã€‚
   - ç„¦é»æ¨™è¨˜ï¼šä¸»äº‹ç„¦é», å—äº‹ç„¦é», è™•æ‰€ç„¦é», å·¥å…·ç„¦é», å—æƒ ç„¦é»ã€‚
   - åŠ©è©/æ™‚è²Œï¼šå®Œæˆè²Œ, é€²è¡Œ, æœªä¾†, å¦å®šè©, ç–‘å•åŠ©è©ã€‚
   - æ ¼å¼ï¼šè‹¥ä¸€å€‹è©åŒ…å«å¤šå€‹åŠŸèƒ½ï¼Œç”¨ `.` æˆ– `-` é€£æ¥ (å¦‚ `æ‰“-å—äº‹ç„¦é»`, `ä½ .ä¸»æ ¼`)ã€‚

ã€ç¯„ä¾‹åƒè€ƒ (ä¾ç…§æ›¸ä¸­ Page 85)ã€‘
è¼¸å…¥ï¼šLmingis ka laqi na.
è¼¸å‡º Markdown è¡¨æ ¼çµæ§‹ï¼š
| Lmingis | ka | laqi | na |
| :--- | :--- | :--- | :--- |
| l<m>ingis | ka | laqi=na | (è‹¥ç„¡é™„è‘—å‰‡ç•™ç©º) |
| <ä¸»äº‹ç„¦é»>å“­ | ä¸»æ ¼ | å°å­©=å¥¹.å±¬æ ¼ | (è‹¥åˆä½µåˆ†æå‰‡ç•™ç©º) |

**æœ€å¾Œä¸€è¡Œ**ï¼šæä¾›æ•´å¥æµæš¢çš„ä¸­æ–‡ç¿»è­¯ã€‚
"""

# --- 4. ä¸»è¼¸å…¥å€ ---
truku_input = st.text_area("è«‹è¼¸å…¥å¤ªé­¯é–£èªå¥å­ï¼š", height=100, placeholder="ä¾‹å¦‚ï¼šMkla su rmngaw kari Truku hug?")

# --- 5. åŸ·è¡Œé‚è¼¯ ---
if st.button("ğŸš€ é–‹å§‹æ¨™è¨»åˆ†æ", type="primary"):
    if not api_key:
        st.error("âŒ è«‹å…ˆåœ¨å·¦å´è¼¸å…¥ Google API Keyï¼")
    elif not truku_input:
        st.warning("âš ï¸ è«‹è¼¸å…¥å¥å­ï¼")
    else:
        # å›ºå®šæ¨¡å‹åƒæ•¸
        MODEL_ID = 'gemini-2.0-flash-001'
        
        try:
            genai.configure(api_key=api_key)
            model = genai.GenerativeModel(MODEL_ID)
            
            with st.spinner('æ­£åœ¨é€²è¡Œçµæ§‹æ‹†è§£èˆ‡å°é½Šåˆ†æ...'):
                # çµ„åˆ Prompt
                full_prompt = f"{grammar_rules}\n\nä½¿ç”¨è€…è¼¸å…¥å¥å­ï¼š{truku_input}\nè«‹è¼¸å‡ºåˆ†æçµæœï¼š"
                
                # ç™¼é€è«‹æ±‚
                response = model.generate_content(full_prompt)
                result = response.text

            # --- 6. çµæœå‘ˆç¾ (å„ªåŒ–ç‰ˆ) ---
            st.markdown("### ğŸ“Š åˆ†æçµæœ")
            st.markdown("ä¾ç…§ã€Šå¤ªé­¯é–£èªèªæ³•æ¦‚è«–ã€‹æ ¼å¼å‘ˆç¾ï¼š")
            
            # é€™è£¡é¡¯ç¤ºçš„æ˜¯ Markdown è¡¨æ ¼ï¼Œæœƒè‡ªå‹•åœ¨ç¶²é ä¸Šå½¢æˆ "å–®è©å°é½Š" çš„æ•ˆæœ
            st.markdown(result)
            
            st.success("åˆ†æå®Œæˆï¼")

        except Exception as e:
            st.error(f"âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š{str(e)}")
            if "404" in str(e):
                st.warning("âš ï¸ æ‰¾ä¸åˆ°æ¨¡å‹ã€‚è«‹ç¢ºèª API Key æ¬Šé™æˆ–æ¨¡å‹åç¨±æ˜¯å¦æ›´å‹•ã€‚")

# --- 7. é å°¾ ---
st.divider()
st.caption("è³‡æ–™ä¾†æºï¼šåŸä½æ°‘æ—å§”å“¡æœƒã€Šå¤ªé­¯é–£èªèªæ³•æ¦‚è«–ã€‹(2018) | Powered by Google Gemini")
